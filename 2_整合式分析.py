import streamlit as st
import google.generativeai as genai

st.set_page_config(page_title="æ™ºæ…§è³‡æ–™åˆ†æå¹³å°", layout="wide")
st.title("ğŸ“Š æ™ºæ…§è³‡æ–™åˆ†æå¹³å°")

# --- ä¸Šå‚³ CSV æˆ–è¼¸å…¥åˆ†æå•é¡Œ ---
uploaded_file = st.file_uploader("è«‹ä¸Šå‚³ CSV æª”æ¡ˆ (å¯é¸)", type=["csv"])
st.markdown("---")

# --- æ•´åˆå¼ AI å°ˆæ¥­ç¶“ç†äººåœ˜éšŠåˆ†æ ---
st.header("ğŸ¤– æ•´åˆå¼ AI å°ˆæ¥­ç¶“ç†äººåœ˜éšŠåˆ†æ (Single API Call)")

# ä½¿ç”¨è€…è¼¸å…¥å•†æ¥­å•é¡Œæˆ–åˆ†æéœ€æ±‚
user_prompt = st.text_area(
    "è«‹æè¿°æ‚¨çš„å•†æ¥­å•é¡Œæˆ–åˆ†æéœ€æ±‚ï¼š",
    placeholder="ä¾‹å¦‚ï¼šåˆ†ææœ¬å­£åº¦ç‡Ÿé‹èˆ‡è²¡å‹™è¡¨ç¾ï¼Œæä¾›ç­–ç•¥å»ºè­°..."
)

if st.button("é–‹å§‹ç”Ÿæˆæ•´åˆå ±å‘Š") and user_prompt.strip() != "":
    with st.spinner("AI å°ˆæ¥­ç¶“ç†äººåœ˜éšŠæ­£åœ¨é€²è¡Œå…¨é¢åˆ†æ..."):
        # çµ„åˆå°ˆå®¶è§’è‰²èªªæ˜
        full_prompt = f"""
ä½ æ˜¯ç”±ä¸‰ä½å°ˆå®¶çµ„æˆçš„åœ˜éšŠï¼š
1. ğŸ“Š CFO è²¡å‹™é•·: å¾è²¡å‹™æŒ‡æ¨™ã€æˆæœ¬æ•ˆç›Šã€æŠ•è³‡å›å ±è§’åº¦åˆ†æã€‚
2. ğŸ­ COO ç‡Ÿé‹é•·: è©•ä¼°ç‡Ÿé‹å¯è¡Œæ€§ã€æ½›åœ¨æµç¨‹èˆ‡é¢¨éšªã€‚
3. ğŸ‘‘ CEO åŸ·è¡Œé•·: ç¶œåˆ CFO èˆ‡ COO çš„åˆ†æï¼Œæä¾›æˆ°ç•¥ç¸½çµèˆ‡æ˜ç¢ºè¡Œå‹•å»ºè­°ã€‚

è«‹åŸºæ–¼ä»¥ä¸‹ä½¿ç”¨è€…éœ€æ±‚ç”Ÿæˆä¸€ä»½å®Œæ•´çš„æ•´åˆå ±å‘Šï¼Œåˆ†ç‚ºä¸‰å€‹éƒ¨åˆ†ï¼š
ä½¿ç”¨è€…éœ€æ±‚: {user_prompt}
æ ¼å¼ï¼š
ğŸ“Š CFO åˆ†æ:
(åˆ†æå…§å®¹)

ğŸ­ COO åˆ†æ:
(åˆ†æå…§å®¹)

ğŸ‘‘ CEO æœ€çµ‚æ±ºç­–:
(åˆ†æå…§å®¹)
"""

        # å‘¼å« Gemini LLM
        model = genai.GenerativeModel("gemini-2.5-Flash")
        response = model.generate_content(full_prompt)

    # é¡¯ç¤ºæ•´åˆå ±å‘Š
    st.subheader("ğŸ“ˆ AI å°ˆæ¥­ç¶“ç†äººåœ˜éšŠæ•´åˆå ±å‘Š")
    st.text_area("å ±å‘Šå…§å®¹", value=response.result, height=500)
