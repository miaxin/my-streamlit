import streamlit as st
import openai  # å‡è¨­ä½¿ç”¨ OpenAI æˆ– Gemini API

# -----------------------------
# 1ï¸âƒ£ ç¢ºèª API Key æ˜¯å¦å·²å­˜æ–¼ session_state
# -----------------------------
if "GOOGLE_API_KEY" not in st.session_state:
    st.warning("è«‹å…ˆåœ¨é¦–é è¼¸å…¥ API Key")
    st.stop()

api_key = st.session_state["GOOGLE_API_KEY"]

# -----------------------------
# 2ï¸âƒ£ é é¢æ¨™é¡Œ
# -----------------------------
st.title("ğŸ“ˆ AI å°ˆæ¥­ç¶“ç†äººåœ˜éšŠæ•´åˆåˆ†æ")
st.markdown("æ¨¡æ“¬ CFOã€COOã€CEO ä¸‰ä½å°ˆå®¶ä¸€æ¬¡ç”Ÿæˆå®Œæ•´å ±å‘Š")

# -----------------------------
# 3ï¸âƒ£ å•†æ¥­å•é¡Œè¼¸å…¥
# -----------------------------
business_question = st.text_area(
    "è«‹è¼¸å…¥æ‚¨çš„å•†æ¥­å•é¡Œæˆ–åˆ†æéœ€æ±‚",
    placeholder="ä¾‹å¦‚ï¼šè«‹åˆ†ææ–°ç”¢å“çš„æŠ•è³‡å›å ±èˆ‡ç‡Ÿé‹é¢¨éšª..."
)

# -----------------------------
# 4ï¸âƒ£ å–®æ¬¡ API è«‹æ±‚ç”Ÿæˆå ±å‘Š
# -----------------------------
if st.button("ç”Ÿæˆæ•´åˆå ±å‘Š") and business_question.strip():
    with st.spinner("AI å°ˆæ¥­ç¶“ç†äººåœ˜éšŠæ­£åœ¨åˆ†æä¸­..."):

        # ä½¿ç”¨ API Key å‘¼å«æ¨¡å‹
        openai.api_key = api_key
        prompt = f"""
        æ¨¡æ“¬ä¸€å€‹ç”± CFOã€COOã€CEO çµ„æˆçš„å°ˆå®¶åœ˜éšŠï¼Œé‡å°ä»¥ä¸‹å•†æ¥­å•é¡Œç”Ÿæˆå®Œæ•´æ•´åˆå ±å‘Šï¼š
        å•†æ¥­å•é¡Œ: {business_question}

        å ±å‘Šè¦æ±‚ï¼š
        1. ğŸ“Š CFO åˆ†æ: è²¡å‹™æŒ‡æ¨™ã€æˆæœ¬æ•ˆç›Šã€æŠ•è³‡å›å ±ã€‚
        2. ğŸ­ COO åˆ†æ: ç‡Ÿé‹å¯è¡Œæ€§ã€æµç¨‹èˆ‡é¢¨éšªã€‚
        3. ğŸ‘‘ CEO æœ€çµ‚æ±ºç­–: ç¶œåˆä»¥ä¸Šè§€é»ï¼Œæä¾›æˆ°ç•¥ç¸½çµèˆ‡å¾ŒçºŒè¡Œå‹•å»ºè­°ã€‚
        """

        response = openai.ChatCompletion.create(
            model="gpt-5-mini",
            messages=[
                {"role": "system", "content": "ä½ æ˜¯é«˜éšä¼æ¥­åˆ†æå°ˆå®¶ã€‚"},
                {"role": "user", "content": prompt}
            ],
            temperature=0.5,
            max_tokens=1500
        )

        report = response.choices[0].message.content

    # -----------------------------
    # 5ï¸âƒ£ é¡¯ç¤ºå ±å‘Š
    # -----------------------------
    st.success("ğŸ“ˆ AI å°ˆæ¥­ç¶“ç†äººåœ˜éšŠæ•´åˆå ±å‘Šå®Œæˆï¼")
    st.markdown(report)
